<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Placar e Filas ao Vivo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <style>
        /* Fundo completamente transparente para overlay */
        body {
            background-color: rgba(0,0,0,0) !important;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Remove barras de rolagem */
            display: flex;
            align-items: center; /* Centraliza verticalmente */
            justify-content: center; /* Centraliza horizontalmente */
            min-height: 100vh; /* Ocupa a altura total da viewport */
        }

        /* Contêiner principal do placar para centralização */
        .placar-container {
            width: 100%;
            max-width: 600px; /* Ajuste conforme a necessidade do seu overlay */
            text-align: center;
        }

        /* Estilos para o balão de último ponto */
        .animate-fade-in-out {
            animation: fadeOut 5s forwards; /* Duração do balão: 5 segundos */
            opacity: 0; 
        }

        @keyframes fadeOut {
            0% { opacity: 0; transform: translateY(20px); } 
            10% { opacity: 1; transform: translateY(0); } /* Mais tempo visível no início */
            90% { opacity: 1; transform: translateY(0); } 
            100% { opacity: 0; transform: translateY(-20px); } 
        }

        /* Estilo para destacar os próximos jogadores */
        .proximo-jogador-geral-1 { background-color: #f3f4f6; } /* Tailwind's gray-100 */
        .proximo-jogador-geral-2 { background-color: #f3f4f6; } /* Tailwind's gray-100 */
        .proximo-jogador-geral-3 { background-color: #f3f4f6; } /* Tailwind's gray-100 */
        .proximo-jogador-geral-4 { background-color: #e5e7eb; } /* Tailwind's gray-200 */
        .proximo-jogador-geral-5 { background-color: #e5e7eb; } /* Tailwind's gray-200 */
        .proximo-jogador-geral-6 { background-color: #e5e7eb; } /* Tailwind's gray-200 */
        .proximo-jogador-geral-7 { background-color: #d1d5db; } /* Tailwind's gray-300 */
        .proximo-jogador-geral-8 { background-color: #d1d5db; } /* Tailwind's gray-300 */
        .proximo-jogador-geral-9 { background-color: #d1d5db; } /* Tailwind's gray-300 */

        .proximo-jogador-estrela-1 { background-color: #f9fafb; } /* Tailwind's gray-50 */
        .proximo-jogador-estrela-2 { background-color: #e5e7eb; } /* Tailwind's gray-200 */
        .proximo-jogador-estrela-3 { background-color: #d1d5db; } /* Tailwind's gray-300 */

        /* NOVO: Esconder nomes dos jogadores em quadra */
        #timeAVisualizador, #timeBVisualizador {
            display: none !important;
        }

        /* NOVO: Esconder a seção de Últimas Partidas */
        #visualizarHistorico {
            display: none !important;
        }
        /* Oculta o cabeçalho "Últimas Partidas" também */
        .bg-white:last-of-type h2 { /* Assume que o último div.bg-white é o de Últimas Partidas */
            display: none !important;
        }
    </style>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import { getFirestore, doc, onSnapshot, collection, query, orderBy, limit, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
      
      // SUAS CREDENCIAIS DO FIREBASE AQUI (COPIADAS DO SEU CONSOLE FIREBASE)
      const firebaseConfig = {
        apiKey: "AIzaSyDeHSudZm5RoiarztXBLHUpQoJ_o-ytHSo",
    	authDomain: "controle-de-partidas.firebaseapp.com",
    	projectId: "controle-de-partidas",
    	storageBucket: "controle-de-partidas.firebasestorage.app",
    	messagingSenderId: "492501310950",
    	appId: "1:492501310950:web:05c7d208c0104a5c2c0a27"
    	};


      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Variáveis locais para armazenar os dados recebidos do Firestore
      let jogadoresStatsLocal = {};
      let estrelasRegistradasLocal = [];
      let jogadoresTravadosLocal = {}; 

      // --- Lógica para ler o placar em tempo real ---
      document.addEventListener('DOMContentLoaded', () => {
          const placarDocRef = doc(db, 'statusJogo', 'placarAtual');
          const filasDocRef = doc(db, 'statusJogo', 'filasAtuais');
          const historicoCollectionRef = collection(db, 'historicoPartidas');
          const statsDocRef = doc(db, 'statusJogo', 'statsJogadores'); 

          // Escutar Placar Atual
          onSnapshot(placarDocRef, (docSnap) => {
              const placarTimeAEl = document.getElementById('placarExibirA');
              const placarTimeBEl = document.getElementById('placarExibirB');
              const vitoriasTimeAEl = document.getElementById('vitoriasExibirA');
              const vitoriasTimeBEl = document.getElementById('vitoriasExibirB');
              const ultimoPontoBalaoEl = document.getElementById('ultimoPontoBalao');
              const listaHistoricoPontosEl = document.getElementById('listaHistoricoPontos');

              const timeAListEl = document.getElementById('timeAVisualizador');
              const timeBListEl = document.getElementById('timeBVisualizador');


              if (docSnap.exists()) {
                  const data = docSnap.data();
                  
                  // Atualiza placar principal
                  placarTimeAEl.textContent = data.timeA !== undefined ? data.timeA : 0;
                  placarTimeBEl.textContent = data.timeB !== undefined ? data.timeB : 0;
                  vitoriasTimeAEl.textContent = data.vitoriasA !== undefined ? data.vitoriasA : 0;
                  vitoriasTimeBEl.textContent = data.vitoriasB !== undefined ? data.vitoriasB : 0;

                  // Atualiza os jogadores em quadra (mesmo que estejam ocultos por CSS)
                  const jogadoresTimeA = data.jogadoresTimeA || []; 
                  const jogadoresTimeB = data.jogadoresTimeB || []; 

                  timeAListEl.innerHTML = jogadoresTimeA.map(j => `<li>${j} ${estrelasRegistradasLocal.includes(j) ? '⭐' : ''}</li>`).join('');
                  timeBListEl.innerHTML = jogadoresTimeB.map(j => `<li>${j} ${estrelasRegistradasLocal.includes(j) ? '⭐' : ''}</li>`).join('');


                  // Lógica do balão de último ponto
                  if (data.ultimoJogadorMarcou || (data.tipoPonto === 'ponto_avulso' && data.timeUltimoMarcador)) {
                      let mensagem;
                      if (data.tipoPonto === 'ponto_avulso') {
                          mensagem = `+1 ponto Time ${data.timeUltimoMarcador}`;
                      } else {
                          mensagem = `+1 ponto ${data.timeUltimoMarcador}: ${data.ultimoJogadorMarcou}`;
                      }
                      ultimoPontoBalaoEl.textContent = mensagem;
                      ultimoPontoBalaoEl.classList.remove('hidden');
                      
                      ultimoPontoBalaoEl.classList.remove('animate-fade-in-out');
                      void ultimoPontoBalaoEl.offsetWidth; 
                      ultimoPontoBalaoEl.classList.add('animate-fade-in-out');
                  } else if (data.tipoPonto === 'reset') {
                      ultimoPontoBalaoEl.classList.add('hidden');
                      ultimoPontoBalaoEl.textContent = '';
                  }
                  else {
                      ultimoPontoBalaoEl.classList.add('hidden');
                  }

                  // Renderiza o histórico de pontos da partida atual (mesmo que esteja oculto por CSS)
                  const historicoPontosDetalhado = data.historicoPontosDetalhado || [];
                  listaHistoricoPontosEl.innerHTML = historicoPontosDetalhado.map(ponto => {
                      const corTimeA = (ponto.time === 'A') ? 'text-green-600' : 'text-gray-700';
                      const corTimeB = (ponto.time === 'B') ? 'text-blue-600' : 'text-gray-700';
                      const corVencedorPonto = (ponto.time === 'A') ? 'text-green-700' : 'text-blue-700'; 
                      
                      let descricaoPonto;
                      if (ponto.tipo === 'ponto_avulso') {
                          descricaoPonto = `Ponto Time ${ponto.time}`;
                      } else {
                          descricaoPonto = `Ponto ${ponto.jogador}`;
                      }

                      return `
                        <li class="text-gray-700">
                            <span class="font-bold ${corTimeA}">${ponto.placarA}</span> x <span class="font-bold ${corTimeB}">${ponto.placarB}</span> - <span class="${corVencedorPonto}">${descricaoPonto}</span>
                        </li>
                      `;
                  }).join('');
                  if (historicoPontosDetalhado.length === 0) {
                      listaHistoricoPontosEl.innerHTML = '<li class="text-gray-500">Nenhum ponto registrado nesta partida.</li>';
                  }

                  console.log("Placar ao vivo e histórico de pontos atualizados:", data);
              } else {
                  placarTimeAEl.textContent = 0;
                  placarTimeBEl.textContent = 0;
                  vitoriasTimeAEl.textContent = 0;
                  placarTimeBEl.textContent = 0;
                  timeAListEl.innerHTML = ''; 
                  timeBListEl.innerHTML = ''; 
                  ultimoPontoBalaoEl.classList.add('hidden');
                  listaHistoricoPontosEl.innerHTML = '<li class="text-gray-500">Nenhum ponto registrado nesta partida.</li>';
                  console.log("Documento do placar não encontrado ou resetado.");
              }
          }, (error) => {
              console.error("Erro ao escutar o placar ao vivo:", error);
              document.getElementById('placarExibirA').textContent = "Erro";
              document.getElementById('placarExibirB').textContent = "Erro";
          });

          // Escutar Filas Atuais
          onSnapshot(filasDocRef, (docSnap) => {
              const filaGeralEl = document.getElementById('visualizarFilaGeral');
              const filaEstrelaEl = document.getElementById('visualizarFilaEstrela');
              
              if (docSnap.exists()) {
                  const data = docSnap.data();
                  const filaGeral = data.filaGeral || [];
                  const filaEstrela = data.filaEstrela || [];
                  jogadoresTravadosLocal = data.jogadoresTravados || {}; // Atualiza a variável local
                  estrelasRegistradasLocal = data.estrelasRegistradas || []; // Atualiza a variável local

                  const filaGeralFiltrada = filaGeral.filter(j => !jogadoresTravadosLocal[j]);
                  const filaEstrelaFiltrada = filaEstrela.filter(j => !jogadoresTravadosLocal[j]);

                  filaGeralEl.innerHTML = filaGeralFiltrada.map((j, i) => { 
                      let destaqueClass = '';
                      if (i === 0) destaqueClass = 'proximo-jogador-geral-1';
                      else if (i === 1) destaqueClass = 'proximo-jogador-geral-2';
                      else if (i === 2) destaqueClass = 'proximo-jogador-geral-3';
                      else if (i === 3) destaqueClass = 'proximo-jogador-geral-4';
                      else if (i === 4) destaqueClass = 'proximo-jogador-geral-5';
                      else if (i === 5) destaqueClass = 'proximo-jogador-geral-6';
                      else if (i === 6) destaqueClass = 'proximo-jogador-geral-7';
                      else if (i === 7) destaqueClass = 'proximo-jogador-geral-8';
                      else if (i === 8) destaqueClass = 'proximo-jogador-geral-9';


                      return `
                        <li class="flex items-center py-1 text-gray-700 ${destaqueClass} px-2 rounded-md">
                            ${i + 1}. ${j} ${estrelasRegistradasLocal.includes(j) ? '⭐' : ''} 
                        </li>
                      `;
                  }).join('');
                  if (filaGeralFiltrada.length === 0) filaGeralEl.innerHTML = '<li class="text-gray-500">Fila geral vazia ou todos travados.</li>';

                  filaEstrelaEl.innerHTML = filaEstrelaFiltrada.map((j, i) => { 
                      let destaqueClass = '';
                      if (i === 0) destaqueClass = 'proximo-jogador-estrela-1'; 
                      else if (i === 1) destaqueClass = 'proximo-jogador-estrela-2';
                      else if (i === 2) destaqueClass = 'proximo-jogador-estrela-3';
                      
                      return `
                        <li class="flex items-center py-1 text-gray-700 ${destaqueClass} px-2 rounded-md">
                            ${i + 1}. ${j} ⭐ 
                        </li>
                      `;
                  }).join('');
                  if (filaEstrelaFiltrada.length === 0) filaEstrelaEl.innerHTML = '<li class="text-gray-500">Fila estrela vazia ou todos travados.</li>';

                  console.log("Filas atualizadas:", data);
              } else {
                  filaGeralEl.innerHTML = '<li class="text-gray-500">Nenhuma fila geral disponível.</li>';
                  filaEstrelaEl.innerHTML = '<li class="text-gray-500">Nenhuma fila estrela disponível.</li>';
                  console.log("Documento de filas não encontrado.");
              }
          }, (error) => {
              console.error("Erro ao escutar filas:", error);
          });

          // Escutar Jogadores Stats Globais (para Ranking e Destaques)
          onSnapshot(statsDocRef, (docSnap) => {
              if (docSnap.exists()) {
                  const data = docSnap.data();
                  jogadoresStatsLocal = data.jogadoresStats || {};
                  // Atualiza o ranking e destaques no visualizador
                  atualizarRankingVisualizador();
                  atualizarDestaquesVisualizador();
                  console.log("Estatísticas de jogadores atualizadas para ranking/destaques.");
              } else {
                  jogadoresStatsLocal = {};
                  atualizarRankingVisualizador();
                  atualizarDestaquesVisualizador();
                  console.log("Documento de estatísticas de jogadores não encontrado.");
              }
          }, (error) => {
              console.error("Erro ao escutar estatísticas de jogadores:", error);
          });


          // Removido listener do Histórico de Partidas, Ranking e Destaques pois não serão exibidos nesta versão.
      });
    </script>
</head>
<body class="bg-gray-100">
    <div class="placar-container bg-white p-6 rounded-xl shadow-lg">
        <div class="placar flex justify-around items-center py-5 bg-gray-50 rounded-lg shadow-inner mb-4">
            <div class="placar-time text-center">
                <div class="placar-time-nome text-lg text-gray-700 mb-1">TIME A</div>
                <div id="placarExibirA" class="text-7xl font-extrabold text-green-600">0</div>
                <div class="text-sm font-medium text-gray-600">Vitórias: <span id="vitoriasExibirA">0</span></div>
                <ul id="timeAVisualizador" class="text-sm text-gray-700 list-none mt-2 space-y-0.5">
                    </ul>
            </div>
            <div class="placar-time text-center">
                <div class="placar-time-nome text-lg text-gray-700 mb-1">TIME B</div>
                <div id="placarExibirB" class="text-7xl font-extrabold text-blue-600">0</div>
                <div class="text-sm font-medium text-gray-600">Vitórias: <span id="vitoriasExibirB">0</span></div>
                <ul id="timeBVisualizador" class="text-sm text-gray-700 list-none mt-2 space-y-0.5">
                    </ul>
            </div>
        </div>
        
        <div id="ultimoPontoBalao" class="mt-6 p-3 bg-indigo-500 text-white font-bold text-xl rounded-lg shadow-md hidden animate-fade-in-out">
            </div>

        </div>

    </body>
</html>
